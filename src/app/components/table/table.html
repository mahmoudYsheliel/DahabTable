<p>{{data()![0].price}}</p>
@if (generatedTC().contextMenu) {
  <p-contextmenu 
    #cm 
    [model]="contextMenuItems()" 
    (onShow)="updateContextMenu()"
    (onHide)="selectedRowForContextMenu = null"
  />
}

<p-table
  #dt
  [scrollable]="generatedTC().scrollable"
  [scrollHeight]="generatedTC().scrollHeight"
  [dataKey]="generatedTC().dataKey"
  [columns]="generatedTC().columns"
  [tableStyle]="generatedTC().tableStyle"
  [value]="data() || []"
  [loading]="generatedTC().isLoading"
  [size]="generatedTC().size"
  [showGridlines]="generatedTC().showGridlines"
  [stripedRows]="generatedTC().stripedRows"
  [paginator]="!currentGroupField() && generatedTC().paginator"
  [rows]="generatedTC().rows || generatedTC().rowsPerPageOptions?.[0] || 10"
  [rowsPerPageOptions]="generatedTC().rowsPerPageOptions"
  [first]="generatedTC().first"
  [showCurrentPageReport]="generatedTC().showCurrentPageReport"
  [currentPageReportTemplate]="generatedTC().currentPageReportTemplate || ''"
  [lazy]="generatedTC().lazy"
  (onLazyLoad)="undefiendHandler(generatedTC().onLazyLoading, $event)"
  [totalRecords]="generatedTC().totalRecords || 0"
  [sortMode]="generatedTC().sortMode || 'single'"
  [(selection)]="selectedProducts"
  (onRowSelect)="undefiendHandler(generatedTC().onRowSelect, $event)"
  (onRowUnselect)="undefiendHandler(generatedTC().onRowUnselect, $event)"
  [expandedRowKeys]="expandedRows()"
  (onRowExpand)="undefiendHandler(generatedTC().onExpansion, $event)"
  (onRowCollapse)="undefiendHandler(generatedTC().onCollapse, $event)"
  [virtualScroll]="generatedTC().virtualScroll || false"
  [virtualScrollItemSize]="generatedTC().virtualScrollItemSize || 40"
  [scrollHeight]="generatedTC().scrollHeight || '600px'"
  [scrollable]="generatedTC().scrollable || false"
  (onEditInit)="onEditInit($event)"
  (onEditComplete)="onEditComplete($event)"
  [reorderableColumns]="generatedTC().reorderableColumns || false"
  (onFilter)="onFilterChange($event)"
  (onSort)="onSortChange($event)"
  (onPage)="undefiendHandler(generatedTC().onPage, $event)"
  [(contextMenuSelection)]="selectedRowForContextMenu"
  [contextMenu]="cm"
  [resizableColumns]="generatedTC().columnResizeable || true"
>


  <!----------- Passed Sections ----------->
  @if (generatedTC().captionTemplate && generatedTC().showCaption) {
  <ng-template #caption>
    <ng-container [ngTemplateOutlet]="generatedTC().captionTemplate"></ng-container>
  </ng-template>
  }

  @if (generatedTC().headerTemplate) {
  <ng-template #header>
    <ng-container
      [ngTemplateOutlet]="generatedTC().headerTemplate"
      [ngTemplateOutletContext]="{ $implicit: generatedTC().columns }"
    ></ng-container>
  </ng-template>
  }

  @if (generatedTC().bodyTemplate) {
  <ng-template #body let-product>
    <ng-container
      [ngTemplateOutlet]="generatedTC().bodyTemplate"
      [ngTemplateOutletContext]="{ $implicit: product, columns: generatedTC().columns }"
    ></ng-container>
  </ng-template>
  }

  @if (generatedTC().footerTemplate && generatedTC().showFooter) {
  <ng-template #footer>
    <ng-container [ngTemplateOutlet]="generatedTC().footerTemplate"></ng-container>
  </ng-template>
  }

  @if (generatedTC().expandable && generatedTC().expandedRowTempelate && !currentGroupField()) {
  <ng-template #expandedrow let-product>
    <tr>
      <td colspan="100%">
        <ng-container
          [ngTemplateOutlet]="generatedTC().expandedRowTempelate"
          [ngTemplateOutletContext]="{ $implicit: product }"
        ></ng-container>
      </td>
    </tr>
  </ng-template>
  }

  <!----------- Default Sections ----------->

  <!-- Caption Section -->
  @if (!generatedTC().captionTemplate && generatedTC().showCaption) {
  <ng-template #caption>
    <app-caption
      [table]="table"
      [(tableConfig)]="tableConfig"
      [(data)]="data"
      [actionTemplate]="generatedTC().captionActionTemplate"
      [title]="generatedTC().captionTitle"
      [showFilter]="generatedTC().showCaptionFilter"
      [showFilterChips]="generatedTC().showfilterChips"
      [globalFilterFields]="generatedTC().globalFilterFields"
      [showInputSearch]="generatedTC().showInputSearch"
      [exportButtons]="generatedTC().exportButtons"
      [exportFilename]="generatedTC().exportFilename || 'export'"
      [exportData]="data()"
      [groupingEnabled]="generatedTC().grouping?.enabled || false"
      [columns]="generatedTC().columns || []"
      [groupableColumns]="generatedTC().grouping?.groupableColumns || []"
      (onGroupFieldChange)="onGroupFieldChange($event)"
      (onExpandAll)="expandAllGroups()"
      (onCollapseAll)="collapseAllGroups()"
    />
  </ng-template>
  }

<!-- Header Section -->
@if (!generatedTC().headerTemplate) {
  <ng-template #header let-column>
    <app-header
      #appHeader
      [expandable]="generatedTC().expandable"
      [selectionMethod]="generatedTC().selectionMethod"
      [freezeExpansion]="generatedTC().freezeExpansion"
      [freezeSelection]="generatedTC().freezeSelection"
      [isGroupMode]="!!currentGroupField()"
      [groupField]="currentGroupField() || ''"
      [columns]="generatedTC().columns || []"
    ></app-header>

    <ng-container
      [ngTemplateOutlet]="appHeader.template"
      [ngTemplateOutletContext]="{ $implicit: column }"
    ></ng-container>
  </ng-template>
  }

<!-- Body Section -->
@if (!generatedTC().bodyTemplate) {
<ng-template #body let-product let-columns="columns" let-expanded="expanded">
  <!-- Create header template for group headers -->
  <app-header 
    #groupHeader 
    [expandable]="generatedTC().expandable"
    [selectionMethod]="generatedTC().selectionMethod"
    [freezeExpansion]="generatedTC().freezeExpansion"
    [freezeSelection]="generatedTC().freezeSelection"
    [isGroupMode]="false"
    [columns]="generatedTC().columns || []"
  ></app-header>
  
  <!-- Single body component handles both modes -->
  <app-body
    #appBody
    [table]="table"
    [expandable]="generatedTC().expandable"
    [columns]="generatedTC().columns"
    [rowClass]="generatedTC().rowClass"
    [rowStyle]="generatedTC().rowStyle"
    [selectionMethod]="generatedTC().selectionMethod"
    [freezeExpansion]="generatedTC().freezeExpansion"
    [freezeSelection]="generatedTC().freezeSelection"
    [isGroupMode]="!!currentGroupField()"
    [groupedData]="groupedData()"
    [groupHeaderTemplate]="groupHeader.template"
    [expandedRowTemplate]="generatedTC().expandedRowTempelate"
    [expandedRows]="expandedRows()"
    [dataKey]="generatedTC().dataKey || 'id'"
    [selectedProducts]="selectedProducts()"
    (onGroupSelect)="handleGroupSelect($event)"
    (onGroupUnselect)="handleGroupUnselect($event)"
    (onGroupRowCreated)="registerGroupRow($event)"
  ></app-body>

  <ng-container
    [ngTemplateOutlet]="appBody.template"
    [ngTemplateOutletContext]="{ $implicit: product, columns, expanded }"
  ></ng-container>
</ng-template>
}





  <!-- Footer Section -->
<ng-template pTemplate="footer" let-columns>
  @if (!generatedTC().footerTemplate && generatedTC().showFooter) {
  <app-footer 
    #aggFooterTemplate 
    [table]="table" 
    [aggregation]="generatedTC().aggregationFuncs"
    [isGroupMode]="!!currentGroupField()"
    [groupedData]="groupedData()"
    [(rerender)]="rerender"
  >
  </app-footer>
  <ng-container [ngTemplateOutlet]="aggFooterTemplate.template"></ng-container>
  }
</ng-template>

</p-table>


<p-table
  #dt
  [dataKey]="generatedTC().dataKey"
  [columns]="generatedTC().columns"
  [value]="data() || []"
  [loading]="generatedTC().isLoading"
  [size]="generatedTC().size"
  [showGridlines]="generatedTC().showGridlines"
  [stripedRows]="generatedTC().stripedRows"
  [paginator]="generatedTC().paginator"
  [rows]="generatedTC().rows"
  [first]="generatedTC().first"
  [showCurrentPageReport]="generatedTC().showCurrentPageReport"
  [currentPageReportTemplate]="generatedTC().currentPageReportTemplate || ''"
  [rowsPerPageOptions]="[5, 10, 20]"
  [lazy]="generatedTC().lazy"
  (onLazyLoad)="undefiendHandler(generatedTC().onLazyLoading, $event)"
  [totalRecords]="generatedTC().totalRecords || 0"
  [sortMode]="generatedTC().sortType || 'single'"
  [(selection)]="selectedProducts"
  (onRowSelect)="undefiendHandler(generatedTC().onRowSelect, $event)"
  (onRowUnselect)="undefiendHandler(generatedTC().onRowUnselect, $event)"
  [expandedRowKeys]="expandedRows()"
  (onRowExpand)="undefiendHandler(generatedTC().onRowSelect, $event)"
  (onRowCollapse)="undefiendHandler(generatedTC().onRowSelect, $event)"
>
  <!----------- Passed Sections ----------->
  @if (generatedTC().captionTemplate && generatedTC().showCaption) {
  <ng-template #caption>
    <ng-container [ngTemplateOutlet]="generatedTC().captionTemplate"></ng-container>
  </ng-template>

  } @if (generatedTC().headerTemplate) {
  <ng-template #header>
    <ng-container
      [ngTemplateOutlet]="generatedTC().headerTemplate"
      [ngTemplateOutletContext]="{ $implicit: generatedTC().columns }"
    ></ng-container>
  </ng-template>

  } @if (generatedTC().bodyTemplate) {
  <ng-template #body let-product>
    <ng-container
      [ngTemplateOutlet]="generatedTC().bodyTemplate"
      [ngTemplateOutletContext]="{ $implicit: product, columns: generatedTC().columns }"
    ></ng-container>
  </ng-template>
  } @if (generatedTC().footerTemplate && generatedTC().showFooter) {
  <ng-template #footer>
    <ng-container [ngTemplateOutlet]="generatedTC().footerTemplate"></ng-container>
  </ng-template>

  }
  @if (generatedTC().expandable && generatedTC().expandedRowTempelate) {
      <ng-template #expandedrow let-product>
        <tr>
          <td colspan="50%">
        <ng-container
          [ngTemplateOutlet]="generatedTC().expandedRowTempelate"
          [ngTemplateOutletContext]="{ $implicit: product }"
        ></ng-container>      
          </td>
        </tr>
      </ng-template>
  }

  <!----------- Defaul Sections ----------->

  <!-- Caption Section -->

  @if (!generatedTC().captionTemplate && generatedTC().showCaption) { 
  <ng-template #caption>
    <app-caption [dt]="dt" [clearFilter]="generatedTC().clearFilters" />
  </ng-template>
  }

  <!-- Header Section -->
  @if (!generatedTC().headerTemplate) {
  <ng-template #header>
    <tr>
      
      @if (generatedTC().expandable) {
      <th style="width: 5rem"></th>
      } @if (generatedTC().selectionMethod == 'checkbox') {
      <th style="width: 4rem"><p-tableHeaderCheckbox /></th>
      } @for (column of generatedTC().columns; track ($index + 'header')) {
      <th [pSortableColumn]="column.sortable ? column.field : undefined">
        <app-header [column]="column"></app-header>
        <!-- <ng-container [ngTemplateOutlet]="column.filterTemplate"></ng-container> -->
      </th>
      }
    </tr>
  </ng-template>
  }
  <!-- Body Section -->
  @if (!generatedTC().bodyTemplate) {
  <ng-template #body let-product let-columns="columns" let-expanded="expanded">
    <tr [ngStyle]="getStyle(product)" [ngClass]="getClass(product)">
      @if (generatedTC().expandable) {
      <td>
        <p-button
          type="button"
          pRipple
          [pRowToggler]="product"
          [text]="true"
          severity="secondary"
          [rounded]="true"
          [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
        />
      </td>
      } @if (generatedTC().selectionMethod == 'checkbox') {
      <td>
        <p-tableCheckbox [value]="product" />
      </td>
      } @for (col of columns; track ($index + 'body_col')) {
      <td>
        @if (col.columnDesgin) {

        <ng-container
          [ngTemplateOutlet]="col.columnDesgin"
          [ngTemplateOutletContext]="{ $implicit: product }"
        ></ng-container>

        } @else {
        <app-body [column]="col" [data]="product" />
        }
      </td>
      }
    </tr>
  </ng-template>
  }

  <!-- Footer Section -->
  @if (!generatedTC().footerTemplate && generatedTC().showFooter) {
  <ng-template #footer>
    <tr>
      <td colSpan="100%">
        <app-footer />
      </td>
    </tr>
  </ng-template>
  }
</p-table>

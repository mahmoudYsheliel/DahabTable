<div style="display: grid;grid-template-columns: 1fr 1fr 1fr;">
  <!-- Left side: Filter, Title, and Grouping -->
  <div style="display: flex; align-items: center; gap: 1rem">
    @if (showFilter()) {


    <p-button outlined icon="pi pi-filter-fill" (click)="menu.toggle($event)"/>

    <p-popover #menu [pt]="{content:{style:'padding:0 ;font-family:Roboto , sans-serif'}}">
      <div>
        <div class="caption-filter-popover-container">
          <div class="caption-filter-header">
            <h4 class="caption-filter-title">Filters</h4>
            <p-button (click)="menu.toggle($event)" icon="pi pi-times" outlined text />
          </div>

          <div class="caption-filter-content">
            <ng-container [ngTemplateOutlet]="filterTemplate()" ></ng-container>

          </div>

          <div class="caption-filter-footer">
            <p-button [pt]="{root:{style:'color:#263238'}}"
              label="Clear" (click)="clear()" outlined text />
            <p-button [pt]="{ root:{style:'height:2rem'}}" label="Search" (click)="search()" />
          </div>


        </div>
      </div>


    </p-popover>
    }



    <!-- Group By Selector -->
    @if (groupingEnabled() && availableGroupFields().length > 0) {
    <div style="display: flex; align-items: center; gap: 0.5rem;">
      <p-select [(ngModel)]="selectedGroupField" [options]="availableGroupFields()" optionLabel="header"
        optionValue="field" placeholder="Group By" [showClear]="true" (onChange)="onGroupChange($event.value)"
        [style]="{'min-width': '150px'}">
        <ng-template let-option #item>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <i class="pi pi-table"></i>
            <span>{{ option.header }}</span>
          </div>
        </ng-template>
      </p-select>

      <!-- Expand/Collapse All buttons -->
      @if (selectedGroupField()) {
      <p-button icon="pi pi-plus" [text]="true" [rounded]="true" size="small" pTooltip="Expand All"
        (onClick)="onExpandAll.emit()" />
      <p-button icon="pi pi-minus" [text]="true" [rounded]="true" size="small" pTooltip="Collapse All"
        (onClick)="onCollapseAll.emit()" />
      }
    </div>
    }


    @if (title()) {
    <p class="caption-title">{{ table().totalRecords }} {{ title() }}</p>
    }

    @if (showInputSearch()) {


    <p-iconfield class="wrapper">
      <p-inputicon  class="pi pi-search" />
      <input pInputText type="text" (input)="searchInput($event)" placeholder="Search" style="height: 2rem;" />
    </p-iconfield  >
    }
  </div>



  <div class="filter-chip-container">
    @if (showFilterChips()) {
    @for (field of globalFilterConfig(); track $index) {
    @if (field.value()) {
    <p-chip class="filter-chip">
      <span> {{ field.header }} : {{ field.value() }} </span>
      <i class="pi pi-times-circle" (click)="clearField(field)"></i>
    </p-chip>
    }
    }
    }

    <!--  Show active grouping as chip -->
    @if (selectedGroupField()) {
    <p-chip>
      <span>Grouped by: {{ selectedGroupHeader() }}</span>
      <i class="pi pi-times-circle" (click)="onGroupChange(null)"></i>
    </p-chip>
    }
  </div>

  <!-- Right side: Search and Export Buttons -->
  <div style="display: flex; align-items: center; gap: 0.5rem">


    <!--Export Buttons - now calling local methods -->
    @if (exportButtons()) {
    <div style="display: flex; gap: 0.5rem">
      @if (exportButtons()?.csv) {
      <p-button icon="pi pi-file" [outlined]="true" severity="secondary" size="small" pTooltip="Export CSV"
        (onClick)="exportCSV()" />
      }
      @if (exportButtons()?.excel) {
      <p-button icon="pi pi-file-excel" [outlined]="true" severity="success" size="small" pTooltip="Export Excel"
        (onClick)="exportExcel()" />
      }
      @if (exportButtons()?.pdf) {
      <p-button pTooltip="Upload Ecel" icon="pi pi-file-pdf" [outlined]="true" severity="danger" size="small"
        pTooltip="Export PDF" (onClick)="exportPDF()" />
      }
      @if (importable()) {
      <input type="file" #fileInput accept=".xlsx,.xls" style="display: none" (change)="onFileSelected($event)" />
      <p-button type="button" (click)="fileInput.click()" icon="pi pi-upload" outlined />

      }

    </div>
    }

    <ng-container [ngTemplateOutlet]="actionTemplate()"></ng-container>
  </div>

  <!-- Middle: Filter Chips -->



</div>